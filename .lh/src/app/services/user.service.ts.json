{
    "sourceFile": "src/app/services/user.service.ts",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 2,
            "patches": [
                {
                    "date": 1763461219138,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1763889659873,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -172,7 +172,22 @@\n   async updateUserProfile(\r\n     userId: string, \r\n     updates: Partial<User>\r\n   ): Promise<void> {\r\n-    await updateDoc(doc(this.firestore, 'users', userId), updates);\r\n+    try {\r\n+      console.log('UserService: Updating user', userId, 'with data:', updates);\r\n+      const userRef = doc(this.firestore, 'users', userId);\r\n+      \r\n+      // Add updatedAt timestamp\r\n+      const updateData = {\r\n+        ...updates,\r\n+        updatedAt: serverTimestamp()\r\n+      };\r\n+      \r\n+      await updateDoc(userRef, updateData);\r\n+      console.log('UserService: Profile updated successfully');\r\n+    } catch (error: any) {\r\n+      console.error('UserService: Error updating profile:', error);\r\n+      throw new Error(`Failed to update profile: ${error.message || 'Unknown error'}`);\r\n+    }\r\n   }\r\n }\n\\ No newline at end of file\n"
                },
                {
                    "date": 1763889847531,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -176,14 +176,24 @@\n     try {\r\n       console.log('UserService: Updating user', userId, 'with data:', updates);\r\n       const userRef = doc(this.firestore, 'users', userId);\r\n       \r\n+      // Filter out undefined values (Firestore doesn't accept undefined)\r\n+      const cleanUpdates: any = {};\r\n+      Object.keys(updates).forEach(key => {\r\n+        const value = (updates as any)[key];\r\n+        if (value !== undefined) {\r\n+          cleanUpdates[key] = value;\r\n+        }\r\n+      });\r\n+      \r\n       // Add updatedAt timestamp\r\n       const updateData = {\r\n-        ...updates,\r\n+        ...cleanUpdates,\r\n         updatedAt: serverTimestamp()\r\n       };\r\n       \r\n+      console.log('UserService: Cleaned update data:', updateData);\r\n       await updateDoc(userRef, updateData);\r\n       console.log('UserService: Profile updated successfully');\r\n     } catch (error: any) {\r\n       console.error('UserService: Error updating profile:', error);\r\n"
                }
            ],
            "date": 1763461219138,
            "name": "Commit-0",
            "content": "import { Injectable } from '@angular/core';\r\nimport { \r\n  Firestore, \r\n  collection, \r\n  doc,\r\n  addDoc,\r\n  updateDoc,\r\n  getDoc,\r\n  getDocs,\r\n  query,\r\n  where,\r\n  serverTimestamp \r\n} from '@angular/fire/firestore';\r\nimport { User, SellerApplication } from '../models/user.model';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class UserService {\r\n  constructor(private firestore: Firestore) {}\r\n\r\n  // Submit seller application\r\n  async submitSellerApplication(\r\n    userId: string,\r\n    userName: string,\r\n    userEmail: string,\r\n    reasonForSelling: string,\r\n    businessDescription: string,\r\n    studentName: string,\r\n    courseName: string,\r\n    studentId?: string,\r\n    yearLevel?: string\r\n  ): Promise<void> {\r\n    const application: Omit<SellerApplication, 'applicationId'> = {\r\n      userId,\r\n      userName,\r\n      userEmail,\r\n      status: 'pending',\r\n      reasonForSelling,\r\n      businessDescription,\r\n      studentName,\r\n      courseName,\r\n      studentId,\r\n      yearLevel,\r\n      submittedAt: serverTimestamp()\r\n    };\r\n\r\n    await addDoc(collection(this.firestore, 'sellerApplications'), application);\r\n  }\r\n\r\n  // Check if user has pending application\r\n  async hasPendingApplication(userId: string): Promise<boolean> {\r\n    const q = query(\r\n      collection(this.firestore, 'sellerApplications'),\r\n      where('userId', '==', userId),\r\n      where('status', '==', 'pending')\r\n    );\r\n    \r\n    const snapshot = await getDocs(q);\r\n    return !snapshot.empty;\r\n  }\r\n\r\n  // Get all pending applications (Admin)\r\n  async getPendingApplications(): Promise<SellerApplication[]> {\r\n    const q = query(\r\n      collection(this.firestore, 'sellerApplications'),\r\n      where('status', '==', 'pending')\r\n    );\r\n    \r\n    const snapshot = await getDocs(q);\r\n    return snapshot.docs.map(doc => ({\r\n      applicationId: doc.id,\r\n      ...doc.data()\r\n    } as SellerApplication));\r\n  }\r\n\r\n  // Get seller applications by status (Admin)\r\n  async getSellerApplications(status?: string): Promise<SellerApplication[]> {\r\n    let q;\r\n    if (status) {\r\n      q = query(\r\n        collection(this.firestore, 'sellerApplications'),\r\n        where('status', '==', status)\r\n      );\r\n    } else {\r\n      q = query(collection(this.firestore, 'sellerApplications'));\r\n    }\r\n    \r\n    const snapshot = await getDocs(q);\r\n    return snapshot.docs.map(doc => ({\r\n      applicationId: doc.id,\r\n      ...doc.data()\r\n    } as SellerApplication));\r\n  }\r\n\r\n  // Approve seller application (Admin)\r\n  async approveSellerApplication(\r\n    applicationId: string, \r\n    userId: string,\r\n    adminId: string\r\n  ): Promise<void> {\r\n    // Update application status\r\n    await updateDoc(doc(this.firestore, 'sellerApplications', applicationId), {\r\n      status: 'approved',\r\n      reviewedAt: serverTimestamp(),\r\n      reviewedBy: adminId\r\n    });\r\n\r\n    // Update user role to seller\r\n    await updateDoc(doc(this.firestore, 'users', userId), {\r\n      role: 'seller'\r\n    });\r\n  }\r\n\r\n  // Reject seller application (Admin)\r\n  async rejectSellerApplication(\r\n    applicationId: string,\r\n    adminId: string\r\n  ): Promise<void> {\r\n    await updateDoc(doc(this.firestore, 'sellerApplications', applicationId), {\r\n      status: 'rejected',\r\n      reviewedAt: serverTimestamp(),\r\n      reviewedBy: adminId\r\n    });\r\n  }\r\n\r\n  // Get user by ID\r\n  async getUserById(userId: string): Promise<User | null> {\r\n    const userDoc = await getDoc(doc(this.firestore, 'users', userId));\r\n    return userDoc.exists() ? userDoc.data() as User : null;\r\n  }\r\n\r\n  // Get all users (Admin)\r\n  async getAllUsers(): Promise<User[]> {\r\n    const snapshot = await getDocs(collection(this.firestore, 'users'));\r\n    return snapshot.docs.map(doc => doc.data() as User);\r\n  }\r\n\r\n  // Get admin users\r\n  async getAdminUsers(): Promise<User[]> {\r\n    const q = query(\r\n      collection(this.firestore, 'users'),\r\n      where('role', '==', 'admin')\r\n    );\r\n    const snapshot = await getDocs(q);\r\n    return snapshot.docs.map(doc => doc.data() as User);\r\n  }\r\n\r\n  // Get all sellers\r\n  async getSellerUsers(): Promise<User[]> {\r\n    const q = query(\r\n      collection(this.firestore, 'users'),\r\n      where('role', '==', 'seller'),\r\n      where('isActive', '==', true)\r\n    );\r\n    const snapshot = await getDocs(q);\r\n    return snapshot.docs.map(doc => doc.data() as User);\r\n  }\r\n\r\n  // Get all customers\r\n  async getCustomerUsers(): Promise<User[]> {\r\n    const q = query(\r\n      collection(this.firestore, 'users'),\r\n      where('role', '==', 'customer'),\r\n      where('isActive', '==', true)\r\n    );\r\n    const snapshot = await getDocs(q);\r\n    return snapshot.docs.map(doc => doc.data() as User);\r\n  }\r\n\r\n  // Update user profile\r\n  async updateUserProfile(\r\n    userId: string, \r\n    updates: Partial<User>\r\n  ): Promise<void> {\r\n    await updateDoc(doc(this.firestore, 'users', userId), updates);\r\n  }\r\n}"
        }
    ]
}