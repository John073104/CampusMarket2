{
    "sourceFile": "src/app/modules/customer/pages/order-detail/order-detail.page.ts",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 2,
            "patches": [
                {
                    "date": 1763390294667,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1763883618691,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,8 +1,8 @@\n import { Component, OnInit } from '@angular/core';\r\n import { CommonModule } from '@angular/common';\r\n import { FormsModule } from '@angular/forms';\r\n-import { IonicModule } from '@ionic/angular';\r\n+import { IonicModule, AlertController, ToastController } from '@ionic/angular';\r\n import { ActivatedRoute, Router } from '@angular/router';\r\n import { OrderService } from 'src/app/services/order.service';\r\n import { ChatService } from 'src/app/services/chat.service';\r\n import { AuthService } from 'src/app/services/auth.service';\r\n@@ -18,15 +18,22 @@\n export class OrderDetailPage implements OnInit {\r\n   order: Order | null = null;\r\n   loading = false;\r\n   orderId = '';\r\n+  isEditing = false;\r\n+  editData = {\r\n+    pickupLocation: '',\r\n+    notes: ''\r\n+  };\r\n \r\n   constructor(\r\n     private route: ActivatedRoute,\r\n     private router: Router,\r\n     private orderService: OrderService,\r\n     private chatService: ChatService,\r\n-    private authService: AuthService\r\n+    private authService: AuthService,\r\n+    private alertController: AlertController,\r\n+    private toastController: ToastController\r\n   ) {}\r\n \r\n   ngOnInit() {\r\n     this.orderId = this.route.snapshot.paramMap.get('id') || '';\r\n@@ -77,7 +84,118 @@\n     } catch (error) {\r\n       console.error('Error creating chat:', error);\r\n     }\r\n   }\r\n+\r\n+  canCancelOrder(): boolean {\r\n+    return this.order?.status === 'placed' || this.order?.status === 'confirmed';\r\n+  }\r\n+\r\n+  canEditOrder(): boolean {\r\n+    return this.order?.status === 'placed';\r\n+  }\r\n+\r\n+  async cancelOrder() {\r\n+    if (!this.order) return;\r\n+\r\n+    const alert = await this.alertController.create({\r\n+      header: 'Cancel Order',\r\n+      message: 'Are you sure you want to cancel this order? This action cannot be undone.',\r\n+      buttons: [\r\n+        {\r\n+          text: 'No',\r\n+          role: 'cancel'\r\n+        },\r\n+        {\r\n+          text: 'Yes, Cancel Order',\r\n+          role: 'destructive',\r\n+          handler: async () => {\r\n+            await this.performCancelOrder();\r\n+          }\r\n+        }\r\n+      ]\r\n+    });\r\n+\r\n+    await alert.present();\r\n+  }\r\n+\r\n+  async performCancelOrder() {\r\n+    if (!this.order?.orderId) return;\r\n+\r\n+    this.loading = true;\r\n+    try {\r\n+      await this.orderService.cancelOrder(this.order.orderId);\r\n+      \r\n+      const toast = await this.toastController.create({\r\n+        message: 'Order cancelled successfully',\r\n+        duration: 2000,\r\n+        color: 'success',\r\n+        position: 'top'\r\n+      });\r\n+      await toast.present();\r\n+      \r\n+      // Reload order to show updated status\r\n+      await this.loadOrder();\r\n+    } catch (error) {\r\n+      console.error('Error cancelling order:', error);\r\n+      const toast = await this.toastController.create({\r\n+        message: 'Failed to cancel order. Please try again.',\r\n+        duration: 3000,\r\n+        color: 'danger',\r\n+        position: 'top'\r\n+      });\r\n+      await toast.present();\r\n+    } finally {\r\n+      this.loading = false;\r\n+    }\r\n+  }\r\n+\r\n+  startEditOrder() {\r\n+    if (!this.order) return;\r\n+    \r\n+    this.isEditing = true;\r\n+    this.editData = {\r\n+      pickupLocation: this.order.pickupLocation || '',\r\n+      notes: this.order.notes || ''\r\n+    };\r\n+  }\r\n+\r\n+  cancelEdit() {\r\n+    this.isEditing = false;\r\n+  }\r\n+\r\n+  async saveOrderChanges() {\r\n+    if (!this.order?.orderId) return;\r\n+\r\n+    this.loading = true;\r\n+    try {\r\n+      await this.orderService.updateOrderDetails(this.order.orderId, {\r\n+        pickupLocation: this.editData.pickupLocation,\r\n+        notes: this.editData.notes\r\n+      });\r\n+      \r\n+      const toast = await this.toastController.create({\r\n+        message: 'Order updated successfully',\r\n+        duration: 2000,\r\n+        color: 'success',\r\n+        position: 'top'\r\n+      });\r\n+      await toast.present();\r\n+      \r\n+      this.isEditing = false;\r\n+      await this.loadOrder();\r\n+    } catch (error) {\r\n+      console.error('Error updating order:', error);\r\n+      const toast = await this.toastController.create({\r\n+        message: 'Failed to update order. Please try again.',\r\n+        duration: 3000,\r\n+        color: 'danger',\r\n+        position: 'top'\r\n+      });\r\n+      await toast.present();\r\n+    } finally {\r\n+      this.loading = false;\r\n+    }\r\n+  }\r\n }\r\n \r\n \r\n"
                },
                {
                    "date": 1764589544539,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -21,9 +21,10 @@\n   orderId = '';\r\n   isEditing = false;\r\n   editData = {\r\n     pickupLocation: '',\r\n-    notes: ''\r\n+    notes: '',\r\n+    items: [] as any[]\r\n   };\r\n \r\n   constructor(\r\n     private route: ActivatedRoute,\r\n@@ -154,24 +155,57 @@\n     \r\n     this.isEditing = true;\r\n     this.editData = {\r\n       pickupLocation: this.order.pickupLocation || '',\r\n-      notes: this.order.notes || ''\r\n+      notes: this.order.notes || '',\r\n+      items: JSON.parse(JSON.stringify(this.order.items)) // Deep copy items\r\n     };\r\n   }\r\n+  \r\n+  updateItemQuantity(index: number, change: number) {\r\n+    if (!this.editData.items[index]) return;\r\n+    \r\n+    const newQty = this.editData.items[index].quantity + change;\r\n+    if (newQty > 0) {\r\n+      this.editData.items[index].quantity = newQty;\r\n+    }\r\n+  }\r\n+  \r\n+  removeItem(index: number) {\r\n+    this.editData.items.splice(index, 1);\r\n+  }\r\n+  \r\n+  getEditTotal(): number {\r\n+    return this.editData.items.reduce((sum, item) => sum + (item.price * item.quantity), 0);\r\n+  }\r\n \r\n   cancelEdit() {\r\n     this.isEditing = false;\r\n   }\r\n \r\n   async saveOrderChanges() {\r\n     if (!this.order?.orderId) return;\r\n+    \r\n+    if (this.editData.items.length === 0) {\r\n+      const toast = await this.toastController.create({\r\n+        message: 'Order must have at least one item',\r\n+        duration: 2000,\r\n+        color: 'warning',\r\n+        position: 'top'\r\n+      });\r\n+      await toast.present();\r\n+      return;\r\n+    }\r\n \r\n     this.loading = true;\r\n     try {\r\n+      const newTotal = this.getEditTotal();\r\n+      \r\n       await this.orderService.updateOrderDetails(this.order.orderId, {\r\n         pickupLocation: this.editData.pickupLocation,\r\n-        notes: this.editData.notes\r\n+        notes: this.editData.notes,\r\n+        items: this.editData.items,\r\n+        totalPrice: newTotal\r\n       });\r\n       \r\n       const toast = await this.toastController.create({\r\n         message: 'Order updated successfully',\r\n"
                }
            ],
            "date": 1763390294667,
            "name": "Commit-0",
            "content": "import { Component, OnInit } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { IonicModule } from '@ionic/angular';\r\nimport { ActivatedRoute, Router } from '@angular/router';\r\nimport { OrderService } from 'src/app/services/order.service';\r\nimport { ChatService } from 'src/app/services/chat.service';\r\nimport { AuthService } from 'src/app/services/auth.service';\r\nimport { Order, OrderStatus } from 'src/app/models/order.model';\r\n\r\n@Component({\r\n  selector: 'app-order-detail',\r\n  templateUrl: './order-detail.page.html',\r\n  styleUrls: ['./order-detail.page.scss'],\r\n  standalone: true,\r\n  imports: [CommonModule, FormsModule, IonicModule]\r\n})\r\nexport class OrderDetailPage implements OnInit {\r\n  order: Order | null = null;\r\n  loading = false;\r\n  orderId = '';\r\n\r\n  constructor(\r\n    private route: ActivatedRoute,\r\n    private router: Router,\r\n    private orderService: OrderService,\r\n    private chatService: ChatService,\r\n    private authService: AuthService\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    this.orderId = this.route.snapshot.paramMap.get('id') || '';\r\n    if (this.orderId) {\r\n      this.loadOrder();\r\n    }\r\n  }\r\n\r\n  async loadOrder() {\r\n    this.loading = true;\r\n    try {\r\n      this.order = await this.orderService.getOrderById(this.orderId);\r\n    } catch (error) {\r\n      console.error('Error loading order:', error);\r\n    } finally {\r\n      this.loading = false;\r\n    }\r\n  }\r\n\r\n  getStatusColor(status: OrderStatus): string {\r\n    const colors: Record<OrderStatus, string> = {\r\n      'placed': 'warning',\r\n      'confirmed': 'primary',\r\n      'ready_for_pickup': 'secondary',\r\n      'completed': 'success',\r\n      'cancelled': 'danger'\r\n    };\r\n    return colors[status] || 'medium';\r\n  }\r\n\r\n  async messageSeller() {\r\n    if (!this.order) return;\r\n\r\n    const user = this.authService.getCurrentUser();\r\n    if (!user) {\r\n      this.router.navigate(['/auth/login']);\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const chatId = await this.chatService.getOrCreateChat(\r\n        user.userId!,\r\n        user.name || user.email,\r\n        this.order.sellerId,\r\n        this.order.sellerName\r\n      );\r\n      this.router.navigate([`/customer/chat/${chatId}`]);\r\n    } catch (error) {\r\n      console.error('Error creating chat:', error);\r\n    }\r\n  }\r\n}\r\n\r\n\r\n"
        }
    ]
}