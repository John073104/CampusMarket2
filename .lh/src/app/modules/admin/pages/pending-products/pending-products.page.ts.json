{
    "sourceFile": "src/app/modules/admin/pages/pending-products/pending-products.page.ts",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1763883756121,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1763883756121,
            "name": "Commit-0",
            "content": "import { Component, OnInit } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { IonicModule, AlertController, ToastController } from '@ionic/angular';\r\nimport { Router } from '@angular/router';\r\nimport { ProductService } from '../../../../services/product.service';\r\nimport { Product } from '../../../../models/product.model';\r\n\r\n@Component({\r\n  selector: 'app-pending-products',\r\n  templateUrl: './pending-products.page.html',\r\n  styleUrls: ['./pending-products.page.scss'],\r\n  standalone: true,\r\n  imports: [CommonModule, FormsModule, IonicModule]\r\n})\r\nexport class PendingProductsPage implements OnInit {\r\n  products: Product[] = [];\r\n  loading: boolean = false;\r\n  selectedImage: string = '';\r\n  showImageModal: boolean = false;\r\n\r\n  constructor(\r\n    private productService: ProductService,\r\n    private alertController: AlertController,\r\n    private toastController: ToastController,\r\n    private router: Router\r\n  ) { }\r\n\r\n  ngOnInit() {\r\n    this.loadProducts();\r\n  }\r\n\r\n  async loadProducts() {\r\n    this.loading = true;\r\n    try {\r\n      console.log('Loading pending products...');\r\n      this.products = await this.productService.getPendingProducts();\r\n      console.log('Loaded products:', this.products.length, this.products);\r\n    } catch (error) {\r\n      console.error('Error loading products:', error);\r\n      \r\n      // Show error toast\r\n      const toast = await this.toastController.create({\r\n        message: 'Failed to load pending products. Please check console for details.',\r\n        duration: 3000,\r\n        color: 'danger',\r\n        position: 'top'\r\n      });\r\n      await toast.present();\r\n    } finally {\r\n      this.loading = false;\r\n    }\r\n  }\r\n\r\n  openImageModal(imageUrl: string) {\r\n    this.selectedImage = imageUrl;\r\n    this.showImageModal = true;\r\n  }\r\n\r\n  closeImageModal() {\r\n    this.showImageModal = false;\r\n    this.selectedImage = '';\r\n  }\r\n\r\n  async approveProduct(productId: string) {\r\n    const alert = await this.alertController.create({\r\n      header: 'Approve Product',\r\n      message: 'Are you sure you want to approve this product?',\r\n      buttons: [\r\n        {\r\n          text: 'Cancel',\r\n          role: 'cancel'\r\n        },\r\n        {\r\n          text: 'Approve',\r\n          role: 'confirm',\r\n          handler: async () => {\r\n            try {\r\n              await this.productService.approveProduct(productId);\r\n              await this.loadProducts();\r\n              \r\n              // Navigate back to dashboard to refresh badge count\r\n              const toast = await this.toastController.create({\r\n                message: 'Product approved successfully! Now visible to customers.',\r\n                duration: 2000,\r\n                color: 'success',\r\n                position: 'top'\r\n              });\r\n              await toast.present();\r\n              \r\n              // Refresh dashboard if no more pending products\r\n              if (this.products.length === 0) {\r\n                setTimeout(() => {\r\n                  this.router.navigate(['/admin/dashboard']);\r\n                }, 2000);\r\n              }\r\n            } catch (error) {\r\n              console.error('Error approving product:', error);\r\n              const toast = await this.toastController.create({\r\n                message: 'Failed to approve product. Please try again.',\r\n                duration: 3000,\r\n                color: 'danger',\r\n                position: 'top'\r\n              });\r\n              await toast.present();\r\n            }\r\n          }\r\n        }\r\n      ]\r\n    });\r\n\r\n    await alert.present();\r\n  }\r\n\r\n  async deleteProduct(productId: string) {\r\n    const alert = await this.alertController.create({\r\n      header: 'Reject Product',\r\n      message: 'Are you sure you want to reject and delete this product?',\r\n      buttons: [\r\n        {\r\n          text: 'Cancel',\r\n          role: 'cancel'\r\n        },\r\n        {\r\n          text: 'Delete',\r\n          role: 'confirm',\r\n          handler: async () => {\r\n            try {\r\n              await this.productService.deleteProduct(productId);\r\n              await this.loadProducts();\r\n              \r\n              const toast = await this.toastController.create({\r\n                message: 'Product rejected and deleted.',\r\n                duration: 2000,\r\n                color: 'warning',\r\n                position: 'top'\r\n              });\r\n              await toast.present();\r\n            } catch (error) {\r\n              console.error('Error deleting product:', error);\r\n              const toast = await this.toastController.create({\r\n                message: 'Failed to delete product. Please try again.',\r\n                duration: 3000,\r\n                color: 'danger',\r\n                position: 'top'\r\n              });\r\n              await toast.present();\r\n            }\r\n          }\r\n        }\r\n      ]\r\n    });\r\n\r\n    await alert.present();\r\n  }\r\n}\r\n\r\n"
        }
    ]
}