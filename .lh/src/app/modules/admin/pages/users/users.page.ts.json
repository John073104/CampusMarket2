{
    "sourceFile": "src/app/modules/admin/pages/users/users.page.ts",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1763384538019,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1763384538019,
            "name": "Commit-0",
            "content": "import { Component, OnInit } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { IonicModule, AlertController, ToastController } from '@ionic/angular';\r\nimport { UserService } from '../../../../services/user.service';\r\nimport { User } from '../../../../models/user.model';\r\n\r\n@Component({\r\n  selector: 'app-users',\r\n  templateUrl: './users.page.html',\r\n  styleUrls: ['./users.page.scss'],\r\n  standalone: true,\r\n  imports: [CommonModule, FormsModule, IonicModule]\r\n})\r\nexport class UsersPage implements OnInit {\r\n  users: User[] = [];\r\n  filteredUsers: User[] = [];\r\n  loading: boolean = false;\r\n  selectedRole: string = 'all';\r\n  searchTerm: string = '';\r\n\r\n  constructor(\r\n    private userService: UserService,\r\n    private alertController: AlertController,\r\n    private toastController: ToastController\r\n  ) { }\r\n\r\n  ngOnInit() {\r\n    this.loadUsers();\r\n  }\r\n\r\n  async loadUsers() {\r\n    this.loading = true;\r\n    try {\r\n      this.users = await this.userService.getAllUsers();\r\n      this.filterUsers();\r\n    } catch (error) {\r\n      console.error('Error loading users:', error);\r\n    } finally {\r\n      this.loading = false;\r\n    }\r\n  }\r\n\r\n  filterUsers() {\r\n    this.filteredUsers = this.users.filter(user => {\r\n      const matchesRole = this.selectedRole === 'all' || user.role === this.selectedRole;\r\n      const matchesSearch = user.email.toLowerCase().includes(this.searchTerm.toLowerCase()) ||\r\n                           user.name?.toLowerCase().includes(this.searchTerm.toLowerCase());\r\n      return matchesRole && matchesSearch;\r\n    });\r\n  }\r\n\r\n  async toggleUserStatus(user: User) {\r\n    const action = user.isActive ? 'ban' : 'activate';\r\n    const alert = await this.alertController.create({\r\n      header: `${action === 'ban' ? 'Ban' : 'Activate'} User`,\r\n      message: `Are you sure you want to ${action} this user?`,\r\n      buttons: [\r\n        {\r\n          text: 'Cancel',\r\n          role: 'cancel'\r\n        },\r\n        {\r\n          text: action === 'ban' ? 'Ban' : 'Activate',\r\n          role: 'confirm',\r\n          handler: async () => {\r\n            try {\r\n              await this.userService.updateUserProfile(user.userId!, { isActive: !user.isActive });\r\n              this.loadUsers();\r\n              \r\n              const toast = await this.toastController.create({\r\n                message: `User ${action === 'ban' ? 'banned' : 'activated'} successfully!`,\r\n                duration: 2000,\r\n                color: 'success',\r\n                position: 'top'\r\n              });\r\n              await toast.present();\r\n            } catch (error) {\r\n              console.error('Error updating user:', error);\r\n              const toast = await this.toastController.create({\r\n                message: 'Failed to update user status. Please try again.',\r\n                duration: 3000,\r\n                color: 'danger',\r\n                position: 'top'\r\n              });\r\n              await toast.present();\r\n            }\r\n          }\r\n        }\r\n      ]\r\n    });\r\n\r\n    await alert.present();\r\n  }\r\n\r\n  getRoleColor(role: string): string {\r\n    const colors: any = {\r\n      'admin': 'danger',\r\n      'seller': 'warning',\r\n      'customer': 'primary'\r\n    };\r\n    return colors[role] || 'medium';\r\n  }\r\n\r\n  onImageError(event: any) {\r\n    // Replace broken image with fallback\r\n    event.target.style.display = 'none';\r\n    const placeholder = event.target.parentElement.querySelector('.avatar-placeholder');\r\n    if (!placeholder) {\r\n      const div = document.createElement('div');\r\n      div.className = 'avatar-placeholder';\r\n      div.innerHTML = '<ion-icon name=\"person\" size=\"large\"></ion-icon>';\r\n      event.target.parentElement.appendChild(div);\r\n    }\r\n  }\r\n}\r\n\r\n"
        }
    ]
}