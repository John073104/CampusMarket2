{
    "sourceFile": "src/app/modules/admin/pages/messages/messages.page.ts",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 3,
            "patches": [
                {
                    "date": 1763885776637,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1763886735699,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -50,16 +50,16 @@\n       }\r\n     }, 10000);\r\n     \r\n     this.chatService.getAllChats().subscribe({\r\n-      next: (chats) => {\r\n+      next: (chats: Chat[]) => {\r\n         clearTimeout(timeout);\r\n         this.allChats = chats;\r\n         this.filteredChats = chats;\r\n         this.loading = false;\r\n         console.log('Loaded all chats:', chats.length);\r\n       },\r\n-      error: (error) => {\r\n+      error: (error: any) => {\r\n         clearTimeout(timeout);\r\n         console.error('Error loading chats:', error);\r\n         this.loading = false;\r\n         this.allChats = [];\r\n@@ -97,10 +97,10 @@\n     }\r\n   }\r\n \r\n   getLastMessageTime(chat: Chat): Date | null {\r\n-    if (chat.lastMessageTimestamp && typeof chat.lastMessageTimestamp.toDate === 'function') {\r\n-      return chat.lastMessageTimestamp.toDate();\r\n+    if (chat.lastMessageTime && typeof chat.lastMessageTime.toDate === 'function') {\r\n+      return chat.lastMessageTime.toDate();\r\n     }\r\n     return null;\r\n   }\r\n }\r\n"
                },
                {
                    "date": 1763888387792,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -38,9 +38,9 @@\n     this.loadAllChats();\r\n   }\r\n \r\n   loadAllChats() {\r\n-    console.log('Loading all platform chats...');\r\n+    console.log('Loading admin chats...');\r\n     \r\n     const timeout = setTimeout(() => {\r\n       if (this.loading) {\r\n         console.warn('Chat loading timeout');\r\n@@ -49,9 +49,10 @@\n         this.filteredChats = [];\r\n       }\r\n     }, 10000);\r\n     \r\n-    this.chatService.getAllChats().subscribe({\r\n+    // Only load chats where current admin is a participant\r\n+    this.chatService.getUserChats(this.currentUserId).subscribe({\r\n       next: (chats: Chat[]) => {\r\n         clearTimeout(timeout);\r\n         this.allChats = chats;\r\n         this.filteredChats = chats;\r\n"
                },
                {
                    "date": 1764592203196,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -92,10 +92,9 @@\n   }\r\n \r\n   viewChat(chat: Chat) {\r\n     if (chat.chatId) {\r\n-      // Navigate to a detailed view (you can create this later)\r\n-      this.router.navigate(['/admin/chat-detail', chat.chatId]);\r\n+      this.router.navigate(['/admin/chat', chat.chatId]);\r\n     }\r\n   }\r\n \r\n   getLastMessageTime(chat: Chat): Date | null {\r\n"
                }
            ],
            "date": 1763885776637,
            "name": "Commit-0",
            "content": "import { Component, OnInit } from '@angular/core';\r\nimport { CommonModule, DatePipe } from '@angular/common';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { IonicModule } from '@ionic/angular';\r\nimport { Router } from '@angular/router';\r\nimport { ChatService } from '../../../../services/chat.service';\r\nimport { AuthService } from '../../../../services/auth.service';\r\nimport { Chat } from '../../../../models/chat.model';\r\n\r\n@Component({\r\n  selector: 'app-messages',\r\n  templateUrl: './messages.page.html',\r\n  styleUrls: ['./messages.page.scss'],\r\n  standalone: true,\r\n  imports: [CommonModule, FormsModule, IonicModule, DatePipe]\r\n})\r\nexport class MessagesPage implements OnInit {\r\n  allChats: Chat[] = [];\r\n  filteredChats: Chat[] = [];\r\n  loading = true;\r\n  searchTerm = '';\r\n  currentUserId = '';\r\n\r\n  constructor(\r\n    private chatService: ChatService,\r\n    private authService: AuthService,\r\n    private router: Router\r\n  ) { }\r\n\r\n  async ngOnInit() {\r\n    const user = this.authService.getCurrentUser();\r\n    if (!user || !user.userId) {\r\n      this.router.navigate(['/login']);\r\n      return;\r\n    }\r\n    \r\n    this.currentUserId = user.userId;\r\n    this.loadAllChats();\r\n  }\r\n\r\n  loadAllChats() {\r\n    console.log('Loading all platform chats...');\r\n    \r\n    const timeout = setTimeout(() => {\r\n      if (this.loading) {\r\n        console.warn('Chat loading timeout');\r\n        this.loading = false;\r\n        this.allChats = [];\r\n        this.filteredChats = [];\r\n      }\r\n    }, 10000);\r\n    \r\n    this.chatService.getAllChats().subscribe({\r\n      next: (chats) => {\r\n        clearTimeout(timeout);\r\n        this.allChats = chats;\r\n        this.filteredChats = chats;\r\n        this.loading = false;\r\n        console.log('Loaded all chats:', chats.length);\r\n      },\r\n      error: (error) => {\r\n        clearTimeout(timeout);\r\n        console.error('Error loading chats:', error);\r\n        this.loading = false;\r\n        this.allChats = [];\r\n        this.filteredChats = [];\r\n      }\r\n    });\r\n  }\r\n\r\n  filterChats() {\r\n    if (!this.searchTerm.trim()) {\r\n      this.filteredChats = this.allChats;\r\n      return;\r\n    }\r\n\r\n    const term = this.searchTerm.toLowerCase();\r\n    this.filteredChats = this.allChats.filter(chat => {\r\n      const participants = Object.values(chat.participantNames).join(' ').toLowerCase();\r\n      const lastMessage = chat.lastMessage?.toLowerCase() || '';\r\n      return participants.includes(term) || lastMessage.includes(term);\r\n    });\r\n  }\r\n\r\n  getParticipantNames(chat: Chat): string {\r\n    return Object.values(chat.participantNames).join(' â†” ');\r\n  }\r\n\r\n  getTotalUnreadCount(chat: Chat): number {\r\n    return Object.values(chat.unreadCount).reduce((sum, count) => sum + count, 0);\r\n  }\r\n\r\n  viewChat(chat: Chat) {\r\n    if (chat.chatId) {\r\n      // Navigate to a detailed view (you can create this later)\r\n      this.router.navigate(['/admin/chat-detail', chat.chatId]);\r\n    }\r\n  }\r\n\r\n  getLastMessageTime(chat: Chat): Date | null {\r\n    if (chat.lastMessageTimestamp && typeof chat.lastMessageTimestamp.toDate === 'function') {\r\n      return chat.lastMessageTimestamp.toDate();\r\n    }\r\n    return null;\r\n  }\r\n}\r\n"
        }
    ]
}