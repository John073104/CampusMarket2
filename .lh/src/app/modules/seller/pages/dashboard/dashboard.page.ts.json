{
    "sourceFile": "src/app/modules/seller/pages/dashboard/dashboard.page.ts",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 1,
            "patches": [
                {
                    "date": 1763638999724,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1763884300193,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -54,8 +54,12 @@\n       this.newOrdersCount = orders.filter(o => \r\n         ['placed', 'confirmed'].includes(o.status)\r\n       ).length;\r\n \r\n+      // Fix any incorrect unread counts (run in background)\r\n+      this.chatService.fixUnreadCounts(userId)\r\n+        .catch(err => console.warn('Could not fix unread counts:', err));\r\n+\r\n       // Load unread messages count\r\n       this.unreadMessagesCount = await this.chatService.getTotalUnreadCount(userId);\r\n \r\n       // Load low stock products (quantity <= 5)\r\n"
                }
            ],
            "date": 1763638999724,
            "name": "Commit-0",
            "content": "import { Component, OnInit } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { IonicModule, AlertController } from '@ionic/angular';\r\nimport { Router } from '@angular/router';\r\nimport { AuthService } from '../../../../services/auth.service';\r\nimport { OrderService } from '../../../../services/order.service';\r\nimport { ChatService } from '../../../../services/chat.service';\r\nimport { ProductService } from '../../../../services/product.service';\r\n\r\n@Component({\r\n  selector: 'app-dashboard',\r\n  templateUrl: './dashboard.page.html',\r\n  styleUrls: ['./dashboard.page.scss'],\r\n  standalone: true,\r\n  imports: [CommonModule, FormsModule, IonicModule]\r\n})\r\nexport class DashboardPage implements OnInit {\r\n  userName = '';\r\n  userEmail = '';\r\n  newOrdersCount = 0;\r\n  unreadMessagesCount = 0;\r\n  lowStockCount = 0;\r\n\r\n  constructor(\r\n    private router: Router,\r\n    private authService: AuthService,\r\n    private alertController: AlertController,\r\n    private orderService: OrderService,\r\n    private chatService: ChatService,\r\n    private productService: ProductService\r\n  ) { }\r\n\r\n  async ngOnInit() {\r\n    const user = this.authService.getCurrentUser();\r\n    if (user) {\r\n      this.userName = user.name || user.email.split('@')[0];\r\n      this.userEmail = user.email;\r\n      await this.loadNotifications(user.userId);\r\n    }\r\n  }\r\n\r\n  ionViewWillEnter() {\r\n    const user = this.authService.getCurrentUser();\r\n    if (user && user.userId) {\r\n      this.loadNotifications(user.userId);\r\n    }\r\n  }\r\n\r\n  async loadNotifications(userId: string) {\r\n    try {\r\n      // Load new orders count (placed/confirmed status)\r\n      const orders = await this.orderService.getOrdersBySeller(userId);\r\n      this.newOrdersCount = orders.filter(o => \r\n        ['placed', 'confirmed'].includes(o.status)\r\n      ).length;\r\n\r\n      // Load unread messages count\r\n      this.unreadMessagesCount = await this.chatService.getTotalUnreadCount(userId);\r\n\r\n      // Load low stock products (quantity <= 5)\r\n      const products = await this.productService.getProductsBySeller(userId);\r\n      this.lowStockCount = products.filter((p: any) => p.stock <= 5 && p.stock > 0).length;\r\n    } catch (error) {\r\n      console.error('Error loading notifications:', error);\r\n    }\r\n  }\r\n\r\n  goToAddProduct() {\r\n    this.router.navigate(['/seller/add-product']);\r\n  }\r\n\r\n  goToProducts() {\r\n    this.router.navigate(['/seller/products']);\r\n  }\r\n\r\n  goToOrders() {\r\n    this.router.navigate(['/seller/orders']);\r\n  }\r\n\r\n  goToChats() {\r\n    this.router.navigate(['/seller/chats']);\r\n  }\r\n\r\n  goToAnalytics() {\r\n    this.router.navigate(['/seller/analytics']);\r\n  }\r\n\r\n  goToProfile() {\r\n    this.router.navigate(['/seller/profile']);\r\n  }\r\n\r\n  async logout() {\r\n    const alert = await this.alertController.create({\r\n      header: 'Sign Out',\r\n      message: 'Are you sure you want to sign out?',\r\n      buttons: [\r\n        {\r\n          text: 'Cancel',\r\n          role: 'cancel'\r\n        },\r\n        {\r\n          text: 'Sign Out',\r\n          role: 'confirm',\r\n          handler: async () => {\r\n            await this.authService.signOut();\r\n            this.router.navigate(['/landing']);\r\n          }\r\n        }\r\n      ]\r\n    });\r\n\r\n    await alert.present();\r\n  }\r\n}\r\n\r\n"
        }
    ]
}