{
    "sourceFile": "src/app/modules/seller/pages/order-detail/order-detail.page.ts",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 1,
            "patches": [
                {
                    "date": 1763390264222,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1763434788549,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -110,7 +110,121 @@\n     } catch (error) {\r\n       console.error('Error creating chat:', error);\r\n     }\r\n   }\r\n+\r\n+  getPaymentMethodLabel(method?: string): string {\r\n+    const labels: Record<string, string> = {\r\n+      'cod': 'Cash on Delivery',\r\n+      'gcash': 'GCash',\r\n+      'bank_transfer': 'Bank Transfer',\r\n+      'meet_and_pay': 'Meet & Pay'\r\n+    };\r\n+    return labels[method || 'cod'] || 'Cash on Delivery';\r\n+  }\r\n+\r\n+  getPaymentStatusColor(status?: string): string {\r\n+    const colors: Record<string, string> = {\r\n+      'pending': 'warning',\r\n+      'verified': 'success',\r\n+      'rejected': 'danger'\r\n+    };\r\n+    return colors[status || 'pending'] || 'medium';\r\n+  }\r\n+\r\n+  async viewPaymentProof(imageUrl: string) {\r\n+    const alert = await this.alertController.create({\r\n+      header: 'Payment Proof',\r\n+      message: `<img src=\"${imageUrl}\" style=\"width: 100%; max-height: 400px; object-fit: contain;\" />`,\r\n+      buttons: ['Close']\r\n+    });\r\n+    await alert.present();\r\n+  }\r\n+\r\n+  async verifyPayment() {\r\n+    const alert = await this.alertController.create({\r\n+      header: 'Verify Payment',\r\n+      message: 'Confirm that you have received the payment?',\r\n+      buttons: [\r\n+        { text: 'Cancel', role: 'cancel' },\r\n+        {\r\n+          text: 'Verify',\r\n+          handler: async () => {\r\n+            try {\r\n+              await this.orderService.verifyPayment(this.orderId);\r\n+              const toast = await this.toastController.create({\r\n+                message: 'Payment verified successfully!',\r\n+                duration: 2000,\r\n+                color: 'success'\r\n+              });\r\n+              await toast.present();\r\n+              await this.loadOrder();\r\n+            } catch (error) {\r\n+              console.error('Error verifying payment:', error);\r\n+              const toast = await this.toastController.create({\r\n+                message: 'Failed to verify payment',\r\n+                duration: 3000,\r\n+                color: 'danger'\r\n+              });\r\n+              await toast.present();\r\n+            }\r\n+          }\r\n+        }\r\n+      ]\r\n+    });\r\n+    await alert.present();\r\n+  }\r\n+\r\n+  async rejectPayment() {\r\n+    const alert = await this.alertController.create({\r\n+      header: 'Reject Payment',\r\n+      message: 'Why are you rejecting this payment proof?',\r\n+      inputs: [\r\n+        {\r\n+          name: 'reason',\r\n+          type: 'textarea',\r\n+          placeholder: 'e.g., Image unclear, wrong amount, invalid receipt...'\r\n+        }\r\n+      ],\r\n+      buttons: [\r\n+        { text: 'Cancel', role: 'cancel' },\r\n+        {\r\n+          text: 'Reject',\r\n+          handler: async (data) => {\r\n+            if (!data.reason) {\r\n+              const toast = await this.toastController.create({\r\n+                message: 'Please provide a reason',\r\n+                duration: 2000,\r\n+                color: 'warning'\r\n+              });\r\n+              await toast.present();\r\n+              return false;\r\n+            }\r\n+\r\n+            try {\r\n+              await this.orderService.rejectPayment(this.orderId, data.reason);\r\n+              const toast = await this.toastController.create({\r\n+                message: 'Payment rejected. Customer will be notified.',\r\n+                duration: 2000,\r\n+                color: 'success'\r\n+              });\r\n+              await toast.present();\r\n+              await this.loadOrder();\r\n+            } catch (error) {\r\n+              console.error('Error rejecting payment:', error);\r\n+              const toast = await this.toastController.create({\r\n+                message: 'Failed to reject payment',\r\n+                duration: 3000,\r\n+                color: 'danger'\r\n+              });\r\n+              await toast.present();\r\n+            }\r\n+            return true;\r\n+          }\r\n+        }\r\n+      ]\r\n+    });\r\n+    await alert.present();\r\n+  }\r\n }\r\n \r\n \r\n"
                }
            ],
            "date": 1763390264222,
            "name": "Commit-0",
            "content": "import { Component, OnInit } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { IonicModule, ToastController, AlertController } from '@ionic/angular';\r\nimport { ActivatedRoute, Router } from '@angular/router';\r\nimport { OrderService } from 'src/app/services/order.service';\r\nimport { ChatService } from 'src/app/services/chat.service';\r\nimport { AuthService } from 'src/app/services/auth.service';\r\nimport { Order, OrderStatus } from 'src/app/models/order.model';\r\n\r\n@Component({\r\n  selector: 'app-order-detail',\r\n  templateUrl: './order-detail.page.html',\r\n  styleUrls: ['./order-detail.page.scss'],\r\n  standalone: true,\r\n  imports: [CommonModule, FormsModule, IonicModule]\r\n})\r\nexport class OrderDetailPage implements OnInit {\r\n  order: Order | null = null;\r\n  loading = false;\r\n  orderId = '';\r\n\r\n  constructor(\r\n    private route: ActivatedRoute,\r\n    private router: Router,\r\n    private orderService: OrderService,\r\n    private chatService: ChatService,\r\n    private authService: AuthService,\r\n    private toastController: ToastController,\r\n    private alertController: AlertController\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    this.orderId = this.route.snapshot.paramMap.get('id') || '';\r\n    if (this.orderId) {\r\n      this.loadOrder();\r\n    }\r\n  }\r\n\r\n  async loadOrder() {\r\n    this.loading = true;\r\n    try {\r\n      this.order = await this.orderService.getOrderById(this.orderId);\r\n    } catch (error) {\r\n      console.error('Error loading order:', error);\r\n    } finally {\r\n      this.loading = false;\r\n    }\r\n  }\r\n\r\n  getStatusColor(status: OrderStatus): string {\r\n    const colors: Record<OrderStatus, string> = {\r\n      'placed': 'warning',\r\n      'confirmed': 'primary',\r\n      'ready_for_pickup': 'secondary',\r\n      'completed': 'success',\r\n      'cancelled': 'danger'\r\n    };\r\n    return colors[status] || 'medium';\r\n  }\r\n\r\n  async updateStatus(newStatus: OrderStatus) {\r\n    const alert = await this.alertController.create({\r\n      header: 'Confirm Status Update',\r\n      message: `Are you sure you want to change order status to \"${newStatus}\"?`,\r\n      buttons: [\r\n        { text: 'Cancel', role: 'cancel' },\r\n        {\r\n          text: 'Confirm',\r\n          handler: async () => {\r\n            try {\r\n              await this.orderService.updateOrderStatus(this.orderId, newStatus);\r\n              const toast = await this.toastController.create({\r\n                message: 'Order status updated successfully',\r\n                duration: 2000,\r\n                color: 'success'\r\n              });\r\n              await toast.present();\r\n              await this.loadOrder();\r\n            } catch (error) {\r\n              console.error('Error updating status:', error);\r\n              const toast = await this.toastController.create({\r\n                message: 'Failed to update order status',\r\n                duration: 3000,\r\n                color: 'danger'\r\n              });\r\n              await toast.present();\r\n            }\r\n          }\r\n        }\r\n      ]\r\n    });\r\n    await alert.present();\r\n  }\r\n\r\n  async messageCustomer() {\r\n    if (!this.order) return;\r\n\r\n    const user = this.authService.getCurrentUser();\r\n    if (!user) return;\r\n\r\n    try {\r\n      const chatId = await this.chatService.getOrCreateChat(\r\n        user.userId!,\r\n        user.name || user.email,\r\n        this.order.customerId,\r\n        this.order.customerName\r\n      );\r\n      this.router.navigate([`/seller/chat/${chatId}`]);\r\n    } catch (error) {\r\n      console.error('Error creating chat:', error);\r\n    }\r\n  }\r\n}\r\n\r\n\r\n"
        }
    ]
}