{
    "sourceFile": "src/app/utils/fix-product-names.ts",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 1,
            "patches": [
                {
                    "date": 1763884980130,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1763885412765,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -46,20 +46,20 @@\n     const snapshot = await getDocs(productsRef);\r\n     \r\n     snapshot.forEach((docSnap) => {\r\n       const product = docSnap.data();\r\n-      const productName = product.title || '';\r\n+      const productName = product['title'] || '';\r\n       \r\n       // Check if product name looks suspicious\r\n       if (looksLikePersonName(productName)) {\r\n         issues.push({\r\n           productId: docSnap.id,\r\n           currentName: productName,\r\n-          sellerId: product.sellerId || '',\r\n-          sellerName: product.sellerName || '',\r\n-          category: product.category || 'Unknown',\r\n-          price: product.price || 0,\r\n-          stock: product.stock || 0\r\n+          sellerId: product['sellerId'] || '',\r\n+          sellerName: product['sellerName'] || '',\r\n+          category: product['category'] || 'Unknown',\r\n+          price: product['price'] || 0,\r\n+          stock: product['stock'] || 0\r\n         });\r\n       }\r\n     });\r\n     \r\n"
                }
            ],
            "date": 1763884980124,
            "name": "Commit-0",
            "content": "/**\r\n * UTILITY TO FIX INCORRECT PRODUCT NAMES\r\n * This script helps identify and fix products that have person names instead of actual product names\r\n */\r\n\r\nimport { Firestore, collection, getDocs, doc, updateDoc } from '@angular/fire/firestore';\r\n\r\nexport interface ProductNameIssue {\r\n  productId: string;\r\n  currentName: string;\r\n  sellerId: string;\r\n  sellerName: string;\r\n  category: string;\r\n  price: number;\r\n  stock: number;\r\n}\r\n\r\n/**\r\n * Check if a product name looks like a person's name\r\n * Returns true if the name has 2+ words with capital letters (likely a person name)\r\n */\r\nfunction looksLikePersonName(name: string): boolean {\r\n  if (!name) return false;\r\n  \r\n  const words = name.trim().split(/\\s+/);\r\n  \r\n  // If it has exactly 2 words and both start with capital letters, likely a person name\r\n  if (words.length === 2) {\r\n    const bothCapitalized = words.every(word => \r\n      word.length > 0 && word[0] === word[0].toUpperCase()\r\n    );\r\n    return bothCapitalized;\r\n  }\r\n  \r\n  return false;\r\n}\r\n\r\n/**\r\n * Scan all products and find those with suspicious names\r\n */\r\nexport async function findProductsWithBadNames(firestore: Firestore): Promise<ProductNameIssue[]> {\r\n  const issues: ProductNameIssue[] = [];\r\n  \r\n  try {\r\n    const productsRef = collection(firestore, 'products');\r\n    const snapshot = await getDocs(productsRef);\r\n    \r\n    snapshot.forEach((docSnap) => {\r\n      const product = docSnap.data();\r\n      const productName = product.title || '';\r\n      \r\n      // Check if product name looks suspicious\r\n      if (looksLikePersonName(productName)) {\r\n        issues.push({\r\n          productId: docSnap.id,\r\n          currentName: productName,\r\n          sellerId: product.sellerId || '',\r\n          sellerName: product.sellerName || '',\r\n          category: product.category || 'Unknown',\r\n          price: product.price || 0,\r\n          stock: product.stock || 0\r\n        });\r\n      }\r\n    });\r\n    \r\n    console.log(`Found ${issues.length} products with suspicious names`);\r\n    return issues;\r\n    \r\n  } catch (error) {\r\n    console.error('Error scanning products:', error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n/**\r\n * Update a product's name\r\n */\r\nexport async function updateProductName(\r\n  firestore: Firestore, \r\n  productId: string, \r\n  newName: string\r\n): Promise<void> {\r\n  try {\r\n    const productRef = doc(firestore, 'products', productId);\r\n    await updateDoc(productRef, {\r\n      title: newName,\r\n      updatedAt: new Date()\r\n    });\r\n    console.log(`‚úÖ Updated product ${productId} to: ${newName}`);\r\n  } catch (error) {\r\n    console.error(`‚ùå Failed to update product ${productId}:`, error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n/**\r\n * Main function to list all problematic products\r\n */\r\nexport async function listProblematicProducts(firestore: Firestore): Promise<void> {\r\n  console.log('üîç Scanning for products with incorrect names...\\n');\r\n  \r\n  const issues = await findProductsWithBadNames(firestore);\r\n  \r\n  if (issues.length === 0) {\r\n    console.log('‚úÖ All product names look correct!');\r\n    return;\r\n  }\r\n  \r\n  console.log('‚ùå Found products that need fixing:\\n');\r\n  console.log('‚ïê'.repeat(80));\r\n  \r\n  issues.forEach((issue, index) => {\r\n    console.log(`\\n${index + 1}. Product ID: ${issue.productId}`);\r\n    console.log(`   Current Name: \"${issue.currentName}\" (looks like seller name!)`);\r\n    console.log(`   Seller: ${issue.sellerName} (ID: ${issue.sellerId})`);\r\n    console.log(`   Category: ${issue.category}`);\r\n    console.log(`   Price: ‚Ç±${issue.price}`);\r\n    console.log(`   Stock: ${issue.stock}`);\r\n    console.log('   ‚îÄ'.repeat(40));\r\n  });\r\n  \r\n  console.log('\\n‚ïê'.repeat(80));\r\n  console.log(`\\nTotal products to fix: ${issues.length}`);\r\n  console.log('\\nTo fix a product, use:');\r\n  console.log('await updateProductName(firestore, \"PRODUCT_ID\", \"Correct Product Name\")');\r\n}\r\n\r\n/**\r\n * Batch update products - helps fix multiple products at once\r\n */\r\nexport async function batchUpdateProductNames(\r\n  firestore: Firestore,\r\n  updates: { productId: string; newName: string }[]\r\n): Promise<void> {\r\n  console.log(`üìù Updating ${updates.length} products...`);\r\n  \r\n  const results = {\r\n    success: 0,\r\n    failed: 0\r\n  };\r\n  \r\n  for (const update of updates) {\r\n    try {\r\n      await updateProductName(firestore, update.productId, update.newName);\r\n      results.success++;\r\n    } catch (error) {\r\n      results.failed++;\r\n    }\r\n  }\r\n  \r\n  console.log(`\\n‚úÖ Successfully updated: ${results.success}`);\r\n  console.log(`‚ùå Failed: ${results.failed}`);\r\n}\r\n"
        }
    ]
}