{
    "sourceFile": "src/app/pages/fix-products/fix-products.page.ts",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1763884980161,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1763884980161,
            "name": "Commit-0",
            "content": "import { Component, OnInit } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { IonicModule, AlertController, ToastController } from '@ionic/angular';\r\nimport { Firestore } from '@angular/fire/firestore';\r\nimport { \r\n  findProductsWithBadNames, \r\n  updateProductName, \r\n  ProductNameIssue \r\n} from '../../utils/fix-product-names';\r\n\r\n@Component({\r\n  selector: 'app-fix-products',\r\n  templateUrl: './fix-products.page.html',\r\n  styleUrls: ['./fix-products.page.scss'],\r\n  standalone: true,\r\n  imports: [CommonModule, FormsModule, IonicModule]\r\n})\r\nexport class FixProductsPage implements OnInit {\r\n  loading = false;\r\n  issues: ProductNameIssue[] = [];\r\n  editingProduct: { productId: string; newName: string } | null = null;\r\n\r\n  constructor(\r\n    private firestore: Firestore,\r\n    private alertController: AlertController,\r\n    private toastController: ToastController\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    this.scanProducts();\r\n  }\r\n\r\n  async scanProducts() {\r\n    this.loading = true;\r\n    try {\r\n      this.issues = await findProductsWithBadNames(this.firestore);\r\n      \r\n      if (this.issues.length === 0) {\r\n        const toast = await this.toastController.create({\r\n          message: '✅ All product names look correct!',\r\n          duration: 3000,\r\n          color: 'success'\r\n        });\r\n        await toast.present();\r\n      }\r\n    } catch (error) {\r\n      console.error('Error scanning products:', error);\r\n      const toast = await this.toastController.create({\r\n        message: '❌ Failed to scan products',\r\n        duration: 3000,\r\n        color: 'danger'\r\n      });\r\n      await toast.present();\r\n    } finally {\r\n      this.loading = false;\r\n    }\r\n  }\r\n\r\n  async fixProduct(issue: ProductNameIssue) {\r\n    const alert = await this.alertController.create({\r\n      header: 'Fix Product Name',\r\n      subHeader: `Current: \"${issue.currentName}\"`,\r\n      message: `Seller: ${issue.sellerName}<br>Category: ${issue.category}<br>Price: ₱${issue.price}`,\r\n      inputs: [\r\n        {\r\n          name: 'newName',\r\n          type: 'text',\r\n          placeholder: 'Enter correct product name',\r\n          attributes: {\r\n            maxlength: 100\r\n          }\r\n        }\r\n      ],\r\n      buttons: [\r\n        {\r\n          text: 'Cancel',\r\n          role: 'cancel'\r\n        },\r\n        {\r\n          text: 'Update',\r\n          handler: async (data) => {\r\n            if (!data.newName || data.newName.trim().length === 0) {\r\n              const toast = await this.toastController.create({\r\n                message: 'Please enter a product name',\r\n                duration: 2000,\r\n                color: 'warning'\r\n              });\r\n              await toast.present();\r\n              return false;\r\n            }\r\n            \r\n            await this.updateProduct(issue.productId, data.newName.trim());\r\n            return true;\r\n          }\r\n        }\r\n      ]\r\n    });\r\n\r\n    await alert.present();\r\n  }\r\n\r\n  async updateProduct(productId: string, newName: string) {\r\n    this.loading = true;\r\n    try {\r\n      await updateProductName(this.firestore, productId, newName);\r\n      \r\n      const toast = await this.toastController.create({\r\n        message: `✅ Updated to: ${newName}`,\r\n        duration: 2000,\r\n        color: 'success'\r\n      });\r\n      await toast.present();\r\n      \r\n      // Refresh the list\r\n      await this.scanProducts();\r\n    } catch (error) {\r\n      console.error('Error updating product:', error);\r\n      const toast = await this.toastController.create({\r\n        message: '❌ Failed to update product',\r\n        duration: 3000,\r\n        color: 'danger'\r\n      });\r\n      await toast.present();\r\n    } finally {\r\n      this.loading = false;\r\n    }\r\n  }\r\n\r\n  async deleteProduct(issue: ProductNameIssue) {\r\n    const alert = await this.alertController.create({\r\n      header: 'Delete Product?',\r\n      message: `Are you sure you want to delete \"${issue.currentName}\"? This action cannot be undone.`,\r\n      buttons: [\r\n        {\r\n          text: 'Cancel',\r\n          role: 'cancel'\r\n        },\r\n        {\r\n          text: 'Delete',\r\n          role: 'destructive',\r\n          handler: async () => {\r\n            // Add delete logic here if needed\r\n            const toast = await this.toastController.create({\r\n              message: 'Delete feature coming soon',\r\n              duration: 2000,\r\n              color: 'warning'\r\n            });\r\n            await toast.present();\r\n          }\r\n        }\r\n      ]\r\n    });\r\n\r\n    await alert.present();\r\n  }\r\n\r\n  getSuggestedName(issue: ProductNameIssue): string {\r\n    // Suggest a name based on category\r\n    const suggestions: { [key: string]: string } = {\r\n      'Food': 'Homemade Food',\r\n      'Snacks': 'Snack Pack',\r\n      'Books': 'Textbook',\r\n      'Accessories': 'Accessory Item',\r\n      'Electronics': 'Electronic Device',\r\n      'Clothing': 'Clothing Item',\r\n      'Other': 'Product Item'\r\n    };\r\n    return suggestions[issue.category] || 'Product';\r\n  }\r\n}\r\n"
        }
    ]
}