{
    "sourceFile": "firestore.rules",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1764508371167,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1764508371167,
            "name": "Commit-0",
            "content": "rules_version = '2';\r\nservice cloud.firestore {\r\n  match /databases/{database}/documents {\r\n    \r\n    // Helper functions\r\n    function isAuthenticated() {\r\n      return request.auth != null;\r\n    }\r\n    \r\n    function isOwner(userId) {\r\n      return isAuthenticated() && request.auth.uid == userId;\r\n    }\r\n    \r\n    function getUserRole() {\r\n      return get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role;\r\n    }\r\n    \r\n    function isAdmin() {\r\n      return isAuthenticated() && getUserRole() == 'admin';\r\n    }\r\n    \r\n    function isSeller() {\r\n      return isAuthenticated() && getUserRole() == 'seller';\r\n    }\r\n    \r\n    function isCustomer() {\r\n      return isAuthenticated() && getUserRole() == 'customer';\r\n    }\r\n    \r\n    // Users collection\r\n    match /users/{userId} {\r\n      // Anyone authenticated can read user data\r\n      allow read: if isAuthenticated();\r\n      \r\n      // Users can create their own profile during signup\r\n      allow create: if isAuthenticated() && request.auth.uid == userId;\r\n      \r\n      // Users can update their own profile, admins can update any\r\n      allow update: if isOwner(userId) || isAdmin();\r\n      \r\n      // Only admins can delete users\r\n      allow delete: if isAdmin();\r\n    }\r\n    \r\n    // Products collection\r\n    match /products/{productId} {\r\n      // Anyone authenticated can read approved products\r\n      allow read: if isAuthenticated();\r\n      \r\n      // Sellers can create products\r\n      allow create: if isAuthenticated() && isSeller();\r\n      \r\n      // Sellers can update their own products, admins can update any\r\n      allow update: if isAuthenticated() && \r\n                      (resource.data.sellerId == request.auth.uid || isAdmin());\r\n      \r\n      // Sellers can delete their own products, admins can delete any\r\n      allow delete: if isAuthenticated() && \r\n                      (resource.data.sellerId == request.auth.uid || isAdmin());\r\n    }\r\n    \r\n    // Orders collection\r\n    match /orders/{orderId} {\r\n      // Customers can read their own orders, sellers can read orders for their products\r\n      allow read: if isAuthenticated() && \r\n                    (resource.data.customerId == request.auth.uid || \r\n                     resource.data.sellerId == request.auth.uid ||\r\n                     isAdmin());\r\n      \r\n      // Customers can create orders\r\n      allow create: if isAuthenticated();\r\n      \r\n      // Customers, sellers, and admins can update orders\r\n      allow update: if isAuthenticated() && \r\n                      (resource.data.customerId == request.auth.uid || \r\n                       resource.data.sellerId == request.auth.uid ||\r\n                       isAdmin());\r\n      \r\n      // Only admins can delete orders\r\n      allow delete: if isAdmin();\r\n    }\r\n    \r\n    // Chats collection\r\n    match /chats/{chatId} {\r\n      // Participants and admins can read chats\r\n      allow read: if isAuthenticated() && \r\n                    (request.auth.uid in resource.data.participantIds || isAdmin());\r\n      \r\n      // Any authenticated user can create chats\r\n      allow create: if isAuthenticated();\r\n      \r\n      // Participants can update chats (for last message, unread counts)\r\n      allow update: if isAuthenticated() && \r\n                      (request.auth.uid in resource.data.participantIds || isAdmin());\r\n      \r\n      // Admins can delete chats\r\n      allow delete: if isAdmin();\r\n      \r\n      // Messages subcollection\r\n      match /messages/{messageId} {\r\n        // Participants can read messages\r\n        allow read: if isAuthenticated() && \r\n                      request.auth.uid in get(/databases/$(database)/documents/chats/$(chatId)).data.participantIds;\r\n        \r\n        // Participants can create messages\r\n        allow create: if isAuthenticated() && \r\n                        request.auth.uid in get(/databases/$(database)/documents/chats/$(chatId)).data.participantIds;\r\n        \r\n        // Participants can update messages (mark as read)\r\n        allow update: if isAuthenticated() && \r\n                        request.auth.uid in get(/databases/$(database)/documents/chats/$(chatId)).data.participantIds;\r\n        \r\n        // No one can delete individual messages\r\n        allow delete: if false;\r\n      }\r\n    }\r\n    \r\n    // Seller Applications collection\r\n    match /sellerApplications/{applicationId} {\r\n      // Users can read their own applications, admins can read all\r\n      allow read: if isAuthenticated() && \r\n                    (resource.data.userId == request.auth.uid || isAdmin());\r\n      \r\n      // Customers can create applications\r\n      allow create: if isAuthenticated() && isCustomer();\r\n      \r\n      // Only admins can update applications (approve/reject)\r\n      allow update: if isAdmin();\r\n      \r\n      // Only admins can delete applications\r\n      allow delete: if isAdmin();\r\n    }\r\n    \r\n    // Notifications collection (if you add it later)\r\n    match /notifications/{notificationId} {\r\n      // Users can read their own notifications\r\n      allow read: if isAuthenticated() && resource.data.userId == request.auth.uid;\r\n      \r\n      // System can create notifications\r\n      allow create: if isAuthenticated();\r\n      \r\n      // Users can update their own notifications (mark as read)\r\n      allow update: if isAuthenticated() && resource.data.userId == request.auth.uid;\r\n      \r\n      // Users can delete their own notifications\r\n      allow delete: if isAuthenticated() && resource.data.userId == request.auth.uid;\r\n    }\r\n  }\r\n}\r\n"
        }
    ]
}